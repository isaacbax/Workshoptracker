<Window x:Class="DesignSheet.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DesignSheet"
        mc:Ignorable="d"
        Title="DesignSheet"
        Height="800"
        Width="1300"
        WindowStyle="None"
        ResizeMode="CanResize"
        Background="#1e1e1e"
        Closing="MainWindow_Closing">

    <Window.Resources>
        <!-- Converters -->
        <local:StatusToBrushConverter x:Key="StatusToBrushConverter" />
        <local:DueDateToBrushConverter x:Key="DueDateToBrushConverter" />
        <local:PriorityToBrushConverter x:Key="PriorityToBrushConverter" />
        <local:RetailOeToBrushConverter x:Key="RetailOeToBrushConverter" />
        <local:ShaftTypeToCustomerBrushConverter x:Key="ShaftTypeToCustomerBrushConverter" />

        <!-- Global dark defaults -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <Style TargetType="Button">
            <Setter Property="Margin" Value="6,0,0,0"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#2d2d30"/>
            <Setter Property="BorderBrush" Value="#3e3e42"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="6,0,0,0"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#2d2d30"/>
            <Setter Property="BorderBrush" Value="#3e3e42"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- ✅ FIX: ComboBox and dropdown items white background -->
        <Style TargetType="ComboBox">
            <Setter Property="Margin" Value="6,0,0,0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#3e3e42"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="IsEditable" Value="False"/>
            <Setter Property="IsTextSearchEnabled" Value="True"/>
        </Style>

        <Style TargetType="ComboBoxItem">
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="Background" Value="White"/>
        </Style>

        <!-- Text inside grid cells -->
        <Style x:Key="CellTextBlockStyle" TargetType="{x:Type TextBlock}">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Base cell style (no conditional formatting here) -->
        <Style x:Key="BaseCellStyle" TargetType="{x:Type DataGridCell}">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#1e1e1e"/>
            <Setter Property="BorderBrush" Value="#333333"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="6,3"/>
        </Style>

        <!-- Row style: keep right-click selection only -->
        <Style x:Key="DesignRowStyle" TargetType="{x:Type DataGridRow}">
            <EventSetter Event="PreviewMouseRightButtonDown" Handler="DesignGridRow_PreviewMouseRightButtonDown"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="42"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Title bar -->
        <Border Grid.Row="0" Background="#2d2d30" BorderBrush="#3e3e42" BorderThickness="0,0,0,1">
            <Grid x:Name="TitleBar" MouseDown="TitleBar_MouseDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="DesignSheet"
                           VerticalAlignment="Center"
                           Margin="12,0,0,0"
                           FontSize="14"
                           FontWeight="SemiBold"/>

                <Button Grid.Column="1" Content="—" Width="46" Height="26" VerticalAlignment="Center"
                        Background="#2d2d30" Click="MinimizeButton_Click"/>

                <Button Grid.Column="2" Content="☐" Width="46" Height="26" VerticalAlignment="Center"
                        Background="#2d2d30" Click="MaximizeRestoreButton_Click"/>

                <Button Grid.Column="3" Content="✕" Width="46" Height="26" VerticalAlignment="Center"
                        Background="#b00020" Click="CloseButton_Click"/>
            </Grid>
        </Border>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="#1e1e1e" BorderBrush="#3e3e42" BorderThickness="0,0,0,1" Padding="10">
            <DockPanel LastChildFill="False">

                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                    <Button Content="Reload" Click="Reload_Click"/>
                    <Button Content="Add Row" Click="AddRow_Click"/>
                    <Button Content="Delete Row" Click="DeleteRow_Click"/>
                    <Button Content="Save" Click="Save_Click"/>
                    <Button Content="Change Password" Click="ChangePassword_Click"/>

                    <TextBlock Text="View:" VerticalAlignment="Center" Margin="18,0,0,0"/>
                    <ComboBox Width="120" SelectionChanged="ViewSizeComboBox_SelectionChanged">
                        <ComboBoxItem Content="Standard" IsSelected="True"/>
                        <ComboBoxItem Content="Medium"/>
                        <ComboBoxItem Content="Large"/>
                    </ComboBox>
                </StackPanel>

                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                    <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBox Width="260"
                             Name="SearchTextBox"
                             TextChanged="SearchTextBox_TextChanged"
                             ToolTip="Type to filter rows"/>
                </StackPanel>

            </DockPanel>
        </Border>

        <!-- DataGrid -->
        <DataGrid Grid.Row="2"
                  x:Name="DesignGrid"
                  Background="#1e1e1e"
                  Foreground="White"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserReorderColumns="True"
                  CanUserResizeColumns="True"
                  CanUserSortColumns="True"
                  RowStyle="{StaticResource DesignRowStyle}"
                  CellStyle="{StaticResource BaseCellStyle}"
                  LoadingRow="DesignGrid_LoadingRow"
                  CellEditEnding="DesignGrid_CellEditEnding"
                  Sorting="DesignGrid_Sorting"
                  PreviewMouseLeftButtonDown="DesignGrid_PreviewMouseLeftButtonDown"
                  MouseMove="DesignGrid_MouseMove"
                  Drop="DesignGrid_Drop"
                  AllowDrop="True">

            <DataGrid.Columns>

                <!-- Retail (cell-only conditional) -->
                <DataGridTextColumn Header="Retail" Binding="{Binding Retail}" Width="110">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock" BasedOn="{StaticResource CellTextBlockStyle}"/>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell" BasedOn="{StaticResource BaseCellStyle}">
                            <Setter Property="Background"
                                    Value="{Binding Retail, Converter={StaticResource RetailOeToBrushConverter}}"/>
                        </Style>
                    </DataGridTextColumn.CellStyle>
                </DataGridTextColumn>

                <!-- OE (cell-only conditional) -->
                <DataGridTextColumn Header="OE" Binding="{Binding OE}" Width="110">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock" BasedOn="{StaticResource CellTextBlockStyle}"/>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell" BasedOn="{StaticResource BaseCellStyle}">
                            <Setter Property="Background"
                                    Value="{Binding OE, Converter={StaticResource RetailOeToBrushConverter}}"/>
                        </Style>
                    </DataGridTextColumn.CellStyle>
                </DataGridTextColumn>

                <!-- Customer (cell-only conditional, driven by ShaftType converter) -->
                <DataGridTextColumn Header="Customer" Binding="{Binding Customer}" Width="160">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock" BasedOn="{StaticResource CellTextBlockStyle}"/>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell" BasedOn="{StaticResource BaseCellStyle}">
                            <Setter Property="Background"
                                    Value="{Binding ShaftType, Converter={StaticResource ShaftTypeToCustomerBrushConverter}}"/>
                        </Style>
                    </DataGridTextColumn.CellStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Serial" Binding="{Binding SerialNumber}" Width="140"
                                    ElementStyle="{StaticResource CellTextBlockStyle}"/>

                <DataGridTextColumn Header="Day Due" Binding="{Binding DayDue}" Width="90"
                                    ElementStyle="{StaticResource CellTextBlockStyle}"/>

                <!-- Date Due (cell-only conditional) -->
                <DataGridTextColumn Header="Date Due" Binding="{Binding DateDueText}" Width="110">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock" BasedOn="{StaticResource CellTextBlockStyle}"/>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell" BasedOn="{StaticResource BaseCellStyle}">
                            <Setter Property="Background"
                                    Value="{Binding DateDueText, Converter={StaticResource DueDateToBrushConverter}}"/>
                        </Style>
                    </DataGridTextColumn.CellStyle>
                </DataGridTextColumn>

                <!-- Status (cell-only conditional) -->
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="120">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock" BasedOn="{StaticResource CellTextBlockStyle}"/>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell" BasedOn="{StaticResource BaseCellStyle}">
                            <Setter Property="Background"
                                    Value="{Binding Status, Converter={StaticResource StatusToBrushConverter}}"/>
                        </Style>
                    </DataGridTextColumn.CellStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Qty" Binding="{Binding Qty}" Width="60"
                                    ElementStyle="{StaticResource CellTextBlockStyle}"/>

                <DataGridTextColumn Header="What Is It" Binding="{Binding WhatIsIt}" Width="200"
                                    ElementStyle="{StaticResource CellTextBlockStyle}"/>

                <DataGridTextColumn Header="PO" Binding="{Binding PO}" Width="120"
                                    ElementStyle="{StaticResource CellTextBlockStyle}"/>

                <DataGridTextColumn Header="What Are We Doing" Binding="{Binding WhatAreWeDoing}" Width="240"
                                    ElementStyle="{StaticResource CellTextBlockStyle}"/>

                <DataGridTextColumn Header="Parts" Binding="{Binding Parts}" Width="160"
                                    ElementStyle="{StaticResource CellTextBlockStyle}"/>

                <DataGridTextColumn Header="Shaft Type" Binding="{Binding ShaftType}" Width="120"
                                    ElementStyle="{StaticResource CellTextBlockStyle}"/>

                <!-- Priority (cell-only conditional) -->
                <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" Width="90">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock" BasedOn="{StaticResource CellTextBlockStyle}"/>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell" BasedOn="{StaticResource BaseCellStyle}">
                            <Setter Property="Background"
                                    Value="{Binding Priority, Converter={StaticResource PriorityToBrushConverter}}"/>
                        </Style>
                    </DataGridTextColumn.CellStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Last User" Binding="{Binding LastUser}" Width="120"
                                    ElementStyle="{StaticResource CellTextBlockStyle}"/>

            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Window>
