<Window x:Class="DesignSheet.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        WindowStyle="None"
        ResizeMode="CanResize"
        Background="#0f172a"
        Title="Workshop Tracker"
        Height="800"
        Width="1400"
        Closing="MainWindow_Closing">

    <Border BorderBrush="#0f766e" BorderThickness="2" CornerRadius="8" Margin="4">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <!-- title bar -->
                <RowDefinition Height="40"/>
                <!-- toolbar -->
                <RowDefinition Height="*"/>
                <!-- content -->
            </Grid.RowDefinitions>

            <!-- TITLE BAR -->
            <Grid Grid.Row="0" Background="#0f766e" MouseDown="TitleBar_MouseDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="Workshop Tracker"
                           VerticalAlignment="Center"
                           Margin="12,0,0,0"
                           Foreground="White"
                           FontWeight="Bold"
                           FontSize="16"/>

                <Button Grid.Column="1"
                        Width="32" Height="24" Margin="0,0,4,0"
                        Content="-"
                        Click="MinimizeButton_Click"
                        Background="Transparent"
                        Foreground="White"
                        BorderBrush="Transparent"/>

                <Button Grid.Column="2"
                        Width="32" Height="24" Margin="0,0,4,0"
                        Content="□"
                        Click="MaximizeRestoreButton_Click"
                        Background="Transparent"
                        Foreground="White"
                        BorderBrush="Transparent"/>

                <Button Grid.Column="3"
                        Width="32" Height="24" Margin="0,0,8,0"
                        Content="X"
                        Click="CloseButton_Click"
                        Background="Transparent"
                        Foreground="White"
                        BorderBrush="Transparent"/>
            </Grid>

            <!-- TOOLBAR -->
            <DockPanel Grid.Row="1" Background="#111827" Margin="0,0,0,2">
                <StackPanel Orientation="Horizontal"
                            DockPanel.Dock="Left"
                            Margin="8,4,0,4">
                    <Button Content="Reload" Width="80" Margin="0,0,6,0"
                            Click="Reload_Click"/>
                    <Button Content="Add Row" Width="80" Margin="0,0,6,0"
                            Click="AddRow_Click"/>
                    <Button Content="Delete Row" Width="90" Margin="0,0,6,0"
                            Click="DeleteRow_Click"/>
                    <Button Content="Save" Width="80" Margin="0,0,6,0"
                            Click="Save_Click"/>
                    <Button Content="Change Password"
                            Width="140"
                            Click="ChangePassword_Click"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal"
                            DockPanel.Dock="Right"
                            Margin="0,4,8,4">
                    <TextBlock Text="View size:"
                               VerticalAlignment="Center"
                               Foreground="White"
                               Margin="0,0,4,0"/>
                    <ComboBox x:Name="ViewSizeComboBox"
                              Width="110"
                              SelectionChanged="ViewSizeComboBox_SelectionChanged">
                        <ComboBoxItem Content="Standard" IsSelected="True"/>
                        <ComboBoxItem Content="Medium"/>
                        <ComboBoxItem Content="Large"/>
                    </ComboBox>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="8,4">
                    <TextBlock Text="Search:"
                               VerticalAlignment="Center"
                               Foreground="White"
                               Margin="0,0,4,0"/>
                    <TextBox x:Name="SearchTextBox"
                             Width="220"
                             TextChanged="SearchTextBox_TextChanged"/>
                </StackPanel>
            </DockPanel>

            <!-- CONTENT -->
            <Grid Grid.Row="2" Background="#020617" Margin="6">
                <TabControl Background="#020617">
                    <!-- ACTIVE TAB -->
                    <TabItem Header="Active">
                        <Grid Margin="0,4,0,0">
                            <DataGrid x:Name="DesignGrid"
                                      ItemsSource="{Binding ActiveDesigns}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      CanUserDeleteRows="False"
                                      CanUserReorderColumns="False"
                                      CanUserSortColumns="False"
                                      GridLinesVisibility="All"
                                      HeadersVisibility="Column"
                                      BorderBrush="#111827"
                                      BorderThickness="1"
                                      FontSize="{Binding GridFontSize}"
                                      CellEditEnding="DesignGrid_CellEditEnding"
                                      LoadingRow="DesignGrid_LoadingRow"
                                      PreviewMouseLeftButtonDown="DesignGrid_PreviewMouseLeftButtonDown"
                                      MouseMove="DesignGrid_MouseMove"
                                      Drop="DesignGrid_Drop"
                                      AllowDrop="True"
                                      Background="White"
                                      ColumnHeaderHeight="26">

                                <!-- ContextMenu as RESOURCE -->
                                <DataGrid.Resources>
                                    <ContextMenu x:Key="RowContextMenu">
                                        <MenuItem Header="Add row above"
                                                  Click="AddRowAbove_Click" />
                                        <MenuItem Header="Add row below"
                                                  Click="AddRowBelow_Click" />
                                        <MenuItem Header="Duplicate row below"
                                                  Click="DuplicateRowBelow_Click" />
                                    </ContextMenu>
                                </DataGrid.Resources>

                                <!-- Row style, including separator rows -->
                                <DataGrid.RowStyle>
                                    <Style TargetType="DataGridRow">
                                        <EventSetter Event="PreviewMouseRightButtonDown"
                                                     Handler="DesignGridRow_PreviewMouseRightButtonDown" />
                                        <Setter Property="ContextMenu"
                                                Value="{StaticResource RowContextMenu}" />
                                        <Style.Triggers>
                                            <!-- Non-editable separator rows -->
                                            <DataTrigger Binding="{Binding IsSeparator}" Value="True">
                                                <Setter Property="IsHitTestVisible" Value="False" />
                                                <Setter Property="Background" Value="#e5e7eb" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGrid.RowStyle>

                                <DataGrid.ColumnHeaderStyle>
                                    <Style TargetType="DataGridColumnHeader">
                                        <Setter Property="Background" Value="White" />
                                        <Setter Property="Foreground" Value="Black" />
                                        <Setter Property="BorderBrush" Value="#111827" />
                                        <Setter Property="BorderThickness" Value="0,0,1,1" />
                                        <Setter Property="FontWeight" Value="Bold" />
                                        <Setter Property="HorizontalContentAlignment"
                                                Value="Center" />
                                    </Style>
                                </DataGrid.ColumnHeaderStyle>

                                <DataGrid.Columns>
                                    <!-- Drag handle – NO Click -->
                                    <DataGridTemplateColumn Width="30">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="⋮"
                                                           FontSize="{Binding GridFontSize,
                                                                              RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           Foreground="#6b7280" />
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                    <!-- Retail (Y/N dropdown) -->
                                    <DataGridTemplateColumn Header="Retail" Width="70" SortMemberPath="Retail">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Retail}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.CellEditingTemplate>
                                            <DataTemplate>
                                                <ComboBox SelectedItem="{Binding Retail, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                          HorizontalContentAlignment="Center">
                                                    <ComboBoxItem Content="Y"/>
                                                    <ComboBoxItem Content="N"/>
                                                </ComboBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellEditingTemplate>
                                    </DataGridTemplateColumn>

                                    <!-- OE (Y/N/Z/A/L dropdown) -->
                                    <DataGridTemplateColumn Header="OE" Width="60" SortMemberPath="OE">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding OE}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.CellEditingTemplate>
                                            <DataTemplate>
                                                <ComboBox SelectedItem="{Binding OE, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                          HorizontalContentAlignment="Center">
                                                    <ComboBoxItem Content="Y"/>
                                                    <ComboBoxItem Content="N"/>
                                                    <ComboBoxItem Content="Z"/>
                                                    <ComboBoxItem Content="A/L"/>
                                                </ComboBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellEditingTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTextColumn Header="Customer"
                                                        Binding="{Binding Customer}"
                                                        Width="150" />
                                    <DataGridTextColumn Header="Serial#"
                                                        Binding="{Binding SerialNumber}"
                                                        Width="120" />
                                    <DataGridTextColumn Header="Day due"
                                                        Binding="{Binding DayDue}"
                                                        Width="80" />
                                    <DataGridTextColumn Header="Date due"
                                                        Binding="{Binding DateDueText}"
                                                        Width="110" />

                                    <!-- Status dropdown -->
                                    <DataGridTemplateColumn Header="Status" Width="110" SortMemberPath="Status">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Status}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.CellEditingTemplate>
                                            <DataTemplate>
                                                <ComboBox SelectedItem="{Binding Status, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                          HorizontalContentAlignment="Center">
                                                    <ComboBoxItem Content="Quote"/>
                                                    <ComboBoxItem Content="Assembly"/>
                                                    <ComboBoxItem Content="Balancing"/>
                                                    <ComboBoxItem Content="Booked in"/>
                                                    <ComboBoxItem Content="Completed"/>
                                                    <ComboBoxItem Content="Paint Shop"/>
                                                    <ComboBoxItem Content="Picking"/>
                                                    <ComboBoxItem Content="Quoting"/>
                                                    <ComboBoxItem Content="Picked Up"/>
                                                    <ComboBoxItem Content="Cancelled"/>
                                                    <ComboBoxItem Content="Drive Shop"/>
                                                    <ComboBoxItem Content="ON HOLD"/>
                                                </ComboBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellEditingTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTextColumn Header="Qty"
                                                        Binding="{Binding Qty}"
                                                        Width="60" />
                                    <DataGridTextColumn Header="What is it"
                                                        Binding="{Binding WhatIsIt}"
                                                        Width="160" />
                                    <DataGridTextColumn Header="PO#"
                                                        Binding="{Binding PO}"
                                                        Width="100" />
                                    <DataGridTextColumn Header="What are we doing"
                                                        Binding="{Binding WhatAreWeDoing}"
                                                        Width="160" />
                                    <DataGridTextColumn Header="Parts"
                                                        Binding="{Binding Parts}"
                                                        Width="120" />

                                    <!-- Shaft type dropdown -->
                                    <DataGridTemplateColumn Header="Shaft type" Width="120" SortMemberPath="ShaftType">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding ShaftType}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.CellEditingTemplate>
                                            <DataTemplate>
                                                <ComboBox SelectedItem="{Binding ShaftType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                          HorizontalContentAlignment="Center">
                                                    <ComboBoxItem Content="Domestic"/>
                                                    <ComboBoxItem Content="Industrial"/>
                                                </ComboBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellEditingTemplate>
                                    </DataGridTemplateColumn>

                                    <!-- Priority dropdown Y/N -->
                                    <DataGridTemplateColumn Header="Priority" Width="80" SortMemberPath="Priority">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Priority}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.CellEditingTemplate>
                                            <DataTemplate>
                                                <ComboBox SelectedItem="{Binding Priority, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                          HorizontalContentAlignment="Center">
                                                    <ComboBoxItem Content="Y"/>
                                                    <ComboBoxItem Content="N"/>
                                                </ComboBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellEditingTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTextColumn Header="Last user"
                                                        Binding="{Binding LastUser}"
                                                        IsReadOnly="True"
                                                        Width="100" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </TabItem>

                    <!-- FINISHED TAB -->
                    <TabItem Header="Picked up / Cancelled">
                        <Grid Margin="0,4,0,0">
                            <DataGrid x:Name="FinishedGrid"
                                      ItemsSource="{Binding FinishedDesigns}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      CanUserDeleteRows="True"
                                      CanUserSortColumns="False"
                                      GridLinesVisibility="All"
                                      HeadersVisibility="Column"
                                      BorderBrush="#111827"
                                      BorderThickness="1"
                                      FontSize="{Binding GridFontSize}"
                                      Background="White"
                                      ColumnHeaderHeight="26">

                                <DataGrid.ColumnHeaderStyle>
                                    <Style TargetType="DataGridColumnHeader">
                                        <Setter Property="Background" Value="White" />
                                        <Setter Property="Foreground" Value="Black" />
                                        <Setter Property="BorderBrush" Value="#111827" />
                                        <Setter Property="BorderThickness" Value="0,0,1,1" />
                                        <Setter Property="FontWeight" Value="Bold" />
                                        <Setter Property="HorizontalContentAlignment"
                                                Value="Center" />
                                    </Style>
                                </DataGrid.ColumnHeaderStyle>

                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Retail"
                                                        Binding="{Binding Retail}"
                                                        Width="70" />
                                    <DataGridTextColumn Header="OE"
                                                        Binding="{Binding OE}"
                                                        Width="60" />
                                    <DataGridTextColumn Header="Customer"
                                                        Binding="{Binding Customer}"
                                                        Width="150" />
                                    <DataGridTextColumn Header="Serial#"
                                                        Binding="{Binding SerialNumber}"
                                                        Width="120" />
                                    <DataGridTextColumn Header="Day due"
                                                        Binding="{Binding DayDue}"
                                                        Width="80" />
                                    <DataGridTextColumn Header="Date due"
                                                        Binding="{Binding DateDueText}"
                                                        Width="110" />
                                    <DataGridTextColumn Header="Status"
                                                        Binding="{Binding Status}"
                                                        Width="110" />
                                    <DataGridTextColumn Header="Qty"
                                                        Binding="{Binding Qty}"
                                                        Width="60" />
                                    <DataGridTextColumn Header="What is it"
                                                        Binding="{Binding WhatIsIt}"
                                                        Width="160" />
                                    <DataGridTextColumn Header="PO#"
                                                        Binding="{Binding PO}"
                                                        Width="100" />
                                    <DataGridTextColumn Header="What are we doing"
                                                        Binding="{Binding WhatAreWeDoing}"
                                                        Width="160" />
                                    <DataGridTextColumn Header="Parts"
                                                        Binding="{Binding Parts}"
                                                        Width="120" />
                                    <DataGridTextColumn Header="Shaft type"
                                                        Binding="{Binding ShaftType}"
                                                        Width="120" />
                                    <DataGridTextColumn Header="Priority"
                                                        Binding="{Binding Priority}"
                                                        Width="80" />
                                    <DataGridTextColumn Header="Last user"
                                                        Binding="{Binding LastUser}"
                                                        Width="100" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>
    </Border>
</Window>
