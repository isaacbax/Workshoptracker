<UserControl x:Class="DesignSheet.Views.WorksGrid"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:views="clr-namespace:DesignSheet.Views"
             xmlns:sys="clr-namespace:System;assembly=mscorlib">

	<UserControl.Resources>
		<!-- Converters -->
		<views:RetailBrushConverter x:Key="RetailBrushConverter"/>
		<views:OeBrushConverter x:Key="OeBrushConverter"/>
		<views:DayDueBrushConverter x:Key="DayDueBrushConverter"/>
		<views:DueDateToBrushConverter x:Key="DateDueBrushConverter"/>
		<views:StatusBrushConverter x:Key="StatusBrushConverter"/>
		<views:ShaftBrushConverter x:Key="ShaftBrushConverter"/>
		<views:PriorityRowBrushConverter x:Key="PriorityRowBrushConverter"/>
		<views:SeparatorEnabledConverter x:Key="SeparatorEnabledConverter"/>
		<views:CustomerShaftBrushConverter x:Key="CustomerShaftBrushConverter"/>

		<!-- Dropdown options -->
		<x:Array x:Key="RetailOptions" Type="{x:Type sys:String}">
			<sys:String>Y</sys:String>
			<sys:String>N</sys:String>
		</x:Array>

		<x:Array x:Key="OeOptions" Type="{x:Type sys:String}">
			<sys:String>Y</sys:String>
			<sys:String>N</sys:String>
			<sys:String>A/L</sys:String>
		</x:Array>

		<x:Array x:Key="DayDueOptions" Type="{x:Type sys:String}">
			<sys:String>mon</sys:String>
			<sys:String>tues</sys:String>
			<sys:String>wed</sys:String>
			<sys:String>thur</sys:String>
			<sys:String>fri</sys:String>
		</x:Array>

		<x:Array x:Key="StatusOptions" Type="{x:Type sys:String}">
			<sys:String>quote</sys:String>
			<sys:String>picking</sys:String>
			<sys:String>assembly</sys:String>
			<sys:String>balancing</sys:String>
			<sys:String>booked in</sys:String>
			<sys:String>paint shop</sys:String>
			<sys:String>completed</sys:String>
			<sys:String>picked up</sys:String>
			<sys:String>cancelled</sys:String>
		</x:Array>

		<x:Array x:Key="ShaftOptions" Type="{x:Type sys:String}">
			<sys:String>domestic</sys:String>
			<sys:String>industrial</sys:String>
		</x:Array>

		<x:Array x:Key="PriorityOptions" Type="{x:Type sys:String}">
			<sys:String>Y</sys:String>
			<sys:String>N</sys:String>
		</x:Array>

		<!-- Context menu -->
		<ContextMenu x:Key="RowContextMenu">
			<MenuItem Header="Add row above"
                      Click="AddRowAbove_Click"
                      CommandParameter="{Binding}"/>
			<MenuItem Header="Add row below"
                      Click="AddRowBelow_Click"
                      CommandParameter="{Binding}"/>
			<MenuItem Header="Copy row"
                      Click="CopyRow_Click"
                      CommandParameter="{Binding}"/>
		</ContextMenu>
	</UserControl.Resources>

	<Grid>
		<DataGrid x:Name="Grid"
                  ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=ItemsSource}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  HeadersVisibility="All"
                  SelectionUnit="FullRow"
                  RowHeaderWidth="26"
                  IsReadOnly="False"
                  AllowDrop="True"
                  PreviewMouseLeftButtonDown="Grid_PreviewMouseLeftButtonDown"
                  MouseMove="Grid_MouseMove"
                  DragOver="Grid_DragOver"
                  Drop="Grid_Drop"
                  CellEditEnding="Grid_CellEditEnding">

			<!-- Drag handle -->
			<DataGrid.RowHeaderTemplate>
				<DataTemplate>
					<Border Background="Transparent">
						<TextBlock Text="â‰¡"
                                   FontSize="14"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Opacity="0.6"
                                   ToolTip="Drag to reorder row"/>
					</Border>
				</DataTemplate>
			</DataGrid.RowHeaderTemplate>

			<DataGrid.RowStyle>
				<Style TargetType="DataGridRow">
					<Setter Property="Background"
                            Value="{Binding Converter={StaticResource PriorityRowBrushConverter}}"/>
					<Setter Property="IsEnabled"
                            Value="{Binding IsSeparator, Converter={StaticResource SeparatorEnabledConverter}}"/>
					<Setter Property="ContextMenu"
                            Value="{StaticResource RowContextMenu}"/>
				</Style>
			</DataGrid.RowStyle>

			<!-- RETAIL -->
			<DataGridTemplateColumn Header="RETAIL" Width="70">
				<DataGridTemplateColumn.CellTemplate>
					<DataTemplate>
						<Border Background="{Binding Row.RETAIL, Converter={StaticResource RetailBrushConverter}}"
                                Padding="4" CornerRadius="6">
							<TextBlock Text="{Binding Row.RETAIL}"
                                       HorizontalAlignment="Center"/>
						</Border>
					</DataTemplate>
				</DataGridTemplateColumn.CellTemplate>
				<DataGridTemplateColumn.CellEditingTemplate>
					<DataTemplate>
						<ComboBox ItemsSource="{StaticResource RetailOptions}"
                                  SelectedItem="{Binding Row.RETAIL, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  HorizontalContentAlignment="Center"
                                  IsDropDownOpen="True"/>
					</DataTemplate>
				</DataGridTemplateColumn.CellEditingTemplate>
			</DataGridTemplateColumn>

			<!-- OE -->
			<DataGridTemplateColumn Header="OE" Width="70">
				<DataGridTemplateColumn.CellTemplate>
					<DataTemplate>
						<Border Background="{Binding Row.OE, Converter={StaticResource OeBrushConverter}}"
                                Padding="4" CornerRadius="6">
							<TextBlock Text="{Binding Row.OE}"
                                       HorizontalAlignment="Center"/>
						</Border>
					</DataTemplate>
				</DataGridTemplateColumn.CellTemplate>
				<DataGridTemplateColumn.CellEditingTemplate>
					<DataTemplate>
						<ComboBox ItemsSource="{StaticSource OeOptions}"
                                  SelectedItem="{Binding Row.OE, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  HorizontalContentAlignment="Center"
                                  IsDropDownOpen="True"/>
					</DataTemplate>
				</DataGridTemplateColumn.CellEditingTemplate>
			</DataGridTemplateColumn>

			<!-- CUSTOMER -->
			<DataGridTemplateColumn Header="CUSTOMER" Width="220">
				<DataGridTemplateColumn.CellTemplate>
					<DataTemplate>
						<Border Background="{Binding Row.SHAFT, Converter={StaticResource CustomerShaftBrushConverter}}"
                                Padding="2">
							<TextBlock Text="{Binding Row.CUSTOMER}" />
						</Border>
					</DataTemplate>
				</DataGridTemplateColumn.CellTemplate>
				<DataGridTemplateColumn.CellEditingTemplate>
					<DataTemplate>
						<TextBox Text="{Binding Row.CUSTOMER, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
					</DataTemplate>
				</DataGridTemplateColumn.CellEditingTemplate>
			</DataGridTemplateColumn>

			<!-- SERIAL -->
			<DataGridTextColumn Header="SERIAL"
                                Binding="{Binding Row.SERIAL, UpdateSourceTrigger=PropertyChanged}"
                                Width="150"/>

			<!-- DAY DUE -->
			<DataGridTemplateColumn Header="DAY DUE" Width="90">
				<DataGridTemplateColumn.CellTemplate>
					<DataTemplate>
						<Border Background="{Binding Row.DAY_DUE, Converter={StaticResource DayDueBrushConverter}}"
                                Padding="4" CornerRadius="6">
							<TextBlock Text="{Binding Row.DAY_DUE}"
                                       HorizontalAlignment="Center"/>
						</Border>
					</DataTemplate>
				</DataGridTemplateColumn.CellTemplate>
				<DataGridTemplateColumn.CellEditingTemplate>
					<DataTemplate>
						<ComboBox ItemsSource="{StaticResource DayDueOptions}"
                                  SelectedItem="{Binding Row.DAY_DUE, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  HorizontalContentAlignment="Center"
                                  IsDropDownOpen="True"/>
					</DataTemplate>
				</DataGridTemplateColumn.CellEditingTemplate>
			</DataGridTemplateColumn>

			<!-- DATE DUE -->
			<DataGridTemplateColumn Header="DATE DUE" Width="110">
				<DataGridTemplateColumn.CellTemplate>
					<DataTemplate>
						<Border Background="{Binding Row.DATE_DUE, Converter={StaticResource DateDueBrushConverter}}"
                                Padding="4" CornerRadius="6">
							<TextBlock Text="{Binding Row.DATE_DUE}"
                                       HorizontalAlignment="Center"/>
						</Border>
					</DataTemplate>
				</DataGridTemplateColumn.CellTemplate>
				<DataGridTemplateColumn.CellEditingTemplate>
					<DataTemplate>
						<TextBox Text="{Binding Row.DATE_DUE, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 HorizontalContentAlignment="Center"/>
					</DataTemplate>
				</DataGridTemplateColumn.CellEditingTemplate>
			</DataGridTemplateColumn>

			<!-- STATUS -->
			<DataGridTemplateColumn Header="STATUS" Width="140">
				<DataGridTemplateColumn.CellTemplate>
					<DataTemplate>
						<Border Background="{Binding Row.STATUS, Converter={StaticResource StatusBrushConverter}}"
                                Padding="4" CornerRadius="6">
							<TextBlock Text="{Binding Row.STATUS}"
                                       HorizontalAlignment="Center"/>
						</Border>
					</DataTemplate>
				</DataGridTemplateColumn.CellTemplate>
				<DataGridTemplateColumn.CellEditingTemplate>
					<DataTemplate>
						<ComboBox ItemsSource="{StaticResource StatusOptions}"
                                  SelectedItem="{Binding Row.STATUS, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  HorizontalContentAlignment="Center"
                                  IsDropDownOpen="True"/>
					</DataTemplate>
				</DataGridTemplateColumn.CellEditingTemplate>
			</DataGridTemplateColumn>

			<!-- QTY / WHAT / PO / DOING / PARTS -->
			<DataGridTextColumn Header="QTY"
                                Binding="{Binding Row.QTY, UpdateSourceTrigger=PropertyChanged}"
                                Width="60"/>
			<DataGridTextColumn Header="WHAT IS IT"
                                Binding="{Binding Row.WHAT_IS_IT, UpdateSourceTrigger=PropertyChanged}"
                                Width="200"/>
			<DataGridTextColumn Header="PO"
                                Binding="{Binding Row.PO, UpdateSourceTrigger=PropertyChanged}"
                                Width="120"/>
			<DataGridTextColumn Header="WHAT ARE WE DOING"
                                Binding="{Binding Row.WHAT_ARE_WE_DOING, UpdateSourceTrigger=PropertyChanged}"
                                Width="260"/>
			<DataGridTextColumn Header="PARTS"
                                Binding="{Binding Row.PARTS, UpdateSourceTrigger=PropertyChanged}"
                                Width="200"/>

			<!-- SHAFT -->
			<DataGridTemplateColumn Header="SHAFT" Width="110">
				<DataGridTemplateColumn.CellTemplate>
					<DataTemplate>
						<Border Background="{Binding Row.SHAFT, Converter={StaticResource ShaftBrushConverter}}"
                                Padding="4" CornerRadius="6">
							<TextBlock Text="{Binding Row.SHAFT}"
                                       HorizontalAlignment="Center"/>
						</Border>
					</DataTemplate>
				</DataGridTemplateColumn.CellTemplate>
				<DataGridTemplateColumn.CellEditingTemplate>
					<DataTemplate>
						<ComboBox ItemsSource="{StaticResource ShaftOptions}"
                                  SelectedItem="{Binding Row.SHAFT, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  HorizontalContentAlignment="Center"
                                  IsDropDownOpen="True"/>
					</DataTemplate>
				</DataGridTemplateColumn.CellEditingTemplate>
			</DataGridTemplateColumn>

			<!-- PRIORITY -->
			<DataGridTemplateColumn Header="PRIORITY" Width="90">
				<DataGridTemplateColumn.CellTemplate>
					<DataTemplate>
						<TextBlock Text="{Binding Row.PRIORITY}"
                                   HorizontalAlignment="Center"/>
					</DataTemplate>
				</DataGridTemplateColumn.CellTemplate>
				<DataGridTemplateColumn.CellEditingTemplate>
					<DataTemplate>
						<ComboBox ItemsSource="{StaticResource PriorityOptions}"
                                  SelectedItem="{Binding Row.PRIORITY, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  HorizontalContentAlignment="Center"
                                  IsDropDownOpen="True"/>
					</DataTemplate>
				</DataGridTemplateColumn.CellEditingTemplate>
			</DataGridTemplateColumn>

			<!-- LAST USER -->
			<DataGridTextColumn Header="LAST USER"
                                Binding="{Binding Row.LAST_USER}"
                                IsReadOnly="True"
                                Width="120"/>
		</DataGrid>
	</Grid>
</UserControl>
